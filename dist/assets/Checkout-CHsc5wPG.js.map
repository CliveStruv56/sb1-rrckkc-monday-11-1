{"version":3,"file":"Checkout-CHsc5wPG.js","sources":["../../src/config/firebase.ts","../../src/services/timeSlots.ts","../../src/components/Checkout.tsx"],"sourcesContent":["import { initializeApp } from 'firebase/app';\nimport { getFirestore, enableMultiTabIndexedDbPersistence } from 'firebase/firestore';\nimport { getAuth } from 'firebase/auth';\n\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n  appId: import.meta.env.VITE_FIREBASE_APP_ID\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst db = getFirestore(app);\nconst auth = getAuth(app);\n\n// Enable offline persistence with multi-tab support\ntry {\n  enableMultiTabIndexedDbPersistence(db).catch((err: { code: string }) => {\n    if (err.code === 'failed-precondition') {\n      console.warn('Multiple tabs open, persistence enabled in first tab only');\n    } else if (err.code === 'unimplemented') {\n      console.warn('Browser doesn\\'t support persistence');\n    }\n  });\n} catch (error) {\n  console.warn('Error enabling persistence:', error);\n}\n\nexport { db, auth };","import { collection, query, where, getDocs, addDoc, Timestamp } from 'firebase/firestore';\nimport { db } from '../config/firebase';\nimport { format } from 'date-fns';\n\ninterface BookedSlot {\n  date: string; // ISO string\n  time: string;\n  orderId: string;\n}\n\nexport const checkSlotAvailability = async (date: Date, time: string): Promise<boolean> => {\n  const dateStr = format(date, 'yyyy-MM-dd');\n  \n  const q = query(\n    collection(db, 'timeSlots'),\n    where('date', '==', dateStr),\n    where('time', '==', time)\n  );\n\n  const querySnapshot = await getDocs(q);\n  const bookedCount = querySnapshot.size;\n  \n  // Currently limiting to 1 booking per slot\n  return bookedCount < 1;\n};\n\nexport const bookTimeSlot = async (date: Date, time: string, orderId: string): Promise<void> => {\n  const dateStr = format(date, 'yyyy-MM-dd');\n  \n  await addDoc(collection(db, 'timeSlots'), {\n    date: dateStr,\n    time,\n    orderId,\n    createdAt: Timestamp.now()\n  });\n};\n\nexport const getAvailableSlots = async (date: Date): Promise<string[]> => {\n  const dateStr = format(date, 'yyyy-MM-dd');\n  \n  const q = query(\n    collection(db, 'timeSlots'),\n    where('date', '==', dateStr)\n  );\n\n  const querySnapshot = await getDocs(q);\n  const bookedSlots = querySnapshot.docs.map(doc => doc.data().time);\n  \n  return bookedSlots;\n};","import React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useCartStore } from '../store/cartStore';\nimport { useDemoModeStore } from '../store/demoModeStore';\nimport { collection, addDoc } from 'firebase/firestore';\nimport { db } from '../config/firebase';\nimport { checkSlotAvailability, bookTimeSlot } from '../services/timeSlots';\nimport { OrderDetails } from '../types';\n\nconst Checkout: React.FC = () => {\n  const { items, getTotal, clearCart, collectionTime } = useCartStore();\n  const { isDemoMode } = useDemoModeStore();\n  const navigate = useNavigate();\n  const [loading, setLoading] = React.useState(false);\n  const [guestEmail, setGuestEmail] = React.useState('');\n\n  React.useEffect(() => {\n    if (items.length === 0 || !collectionTime) {\n      navigate('/cart');\n    }\n  }, [items, collectionTime, navigate]);\n\n  const handlePlaceOrder = async () => {\n    if (!collectionTime) return;\n\n    setLoading(true);\n    try {\n      const isAvailable = await checkSlotAvailability(\n        collectionTime.date,\n        collectionTime.time\n      );\n\n      if (!isAvailable) {\n        alert('Sorry, this time slot is no longer available. Please select another time.');\n        navigate('/collection-time');\n        return;\n      }\n\n      const orderDetails: OrderDetails = {\n        items: items.map(item => ({\n          product: {\n            name: item.product.name,\n            price: Number(item.product.price)\n          },\n          quantity: Number(item.quantity),\n          selectedOption: item.selectedOption || null\n        })),\n        total: Number(getTotal()),\n        pickupDate: collectionTime.date.toISOString(),\n        pickupTime: collectionTime.time,\n        createdAt: new Date().toISOString(),\n        userId: 'guest',\n        userEmail: guestEmail || 'guest',\n        paymentStatus: isDemoMode ? 'completed' : 'pending',\n        status: 'new'\n      };\n\n      const orderRef = await addDoc(collection(db, 'orders'), orderDetails);\n      await bookTimeSlot(collectionTime.date, collectionTime.time, orderRef.id);\n\n      navigate('/confirmation', { \n        state: { orderDetails },\n        replace: true \n      });\n\n      setTimeout(() => clearCart(), 100);\n    } catch (error) {\n      console.error('Error placing order:', error);\n      alert('There was an error placing your order. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!collectionTime) return null;\n\n  const total = getTotal();\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h2 className=\"text-2xl font-bold mb-6\">Checkout</h2>\n\n      {isDemoMode && (\n        <div className=\"bg-yellow-100 text-yellow-800 p-4 rounded-lg mb-6\">\n          <p className=\"font-medium\">Demo Mode Active</p>\n          <p className=\"text-sm\">Orders will be processed without real payments.</p>\n        </div>\n      )}\n\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-8\">\n        <h3 className=\"text-xl font-semibold mb-4\">Collection Time</h3>\n        <p className=\"text-lg\">\n          {collectionTime.date.toLocaleDateString('en-US', {\n            weekday: 'long',\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric'\n          })} at {collectionTime.time}\n        </p>\n      </div>\n\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-8\">\n        <h3 className=\"text-xl font-semibold mb-4\">Contact Details</h3>\n        <div className=\"mb-4\">\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Email (optional)\n          </label>\n          <input\n            type=\"email\"\n            id=\"email\"\n            value={guestEmail}\n            onChange={(e) => setGuestEmail(e.target.value)}\n            placeholder=\"Enter your email for order updates\"\n            className=\"w-full p-2 border rounded-md\"\n          />\n        </div>\n      </div>\n\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-8\">\n        <h3 className=\"text-xl font-semibold mb-4\">Order Summary</h3>\n        {items.map((item) => (\n          <div key={`${item.product.id}-${item.selectedOption || 'no-option'}`} className=\"flex justify-between mb-3 pb-3 border-b\">\n            <div>\n              <p className=\"font-medium\">{item.product.name}</p>\n              <p className=\"text-sm\">Quantity: {item.quantity}</p>\n            </div>\n            <p className=\"font-medium\">£{(item.product.price * item.quantity).toFixed(2)}</p>\n          </div>\n        ))}\n\n        <div className=\"mt-4 pt-4 border-t\">\n          <div className=\"flex justify-between text-lg font-bold\">\n            <span>Total:</span>\n            <span>£{total.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex gap-4\">\n        <button\n          onClick={() => navigate('/menu')}\n          className=\"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors\"\n        >\n          Continue Shopping\n        </button>\n        <button\n          onClick={() => navigate('/collection-time')}\n          className=\"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors\"\n        >\n          Change Collection Time\n        </button>\n        <button\n          onClick={handlePlaceOrder}\n          disabled={loading}\n          className=\"flex-1 bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-400\"\n        >\n          {loading ? 'Processing...' : isDemoMode ? 'Place Demo Order' : 'Place Order'}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;"],"names":["firebaseConfig","app","initializeApp","db","getFirestore","getAuth","enableMultiTabIndexedDbPersistence","err","error","checkSlotAvailability","date","time","dateStr","format","q","query","collection","where","getDocs","bookTimeSlot","orderId","addDoc","Timestamp","Checkout","items","getTotal","clearCart","collectionTime","useCartStore","isDemoMode","useDemoModeStore","navigate","useNavigate","loading","setLoading","React","guestEmail","setGuestEmail","handlePlaceOrder","orderDetails","item","orderRef","total","jsxs","jsx","e"],"mappings":"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"}