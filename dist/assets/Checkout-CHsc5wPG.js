import{u as v,j as e}from"./index-4COKuHxl.js";import{u as C,R as d}from"./vendor-react-S76kyUnC.js";import{u as k}from"./demoModeStore-Ba8Qd-Nc.js";import{i as D,y as T,g as M,z as q,q as A,x as g,c as m,d as O,f as h,T as E}from"./vendor-firebase-DU3MYe4I.js";import{f}from"./vendor-utils-BGzRgZPY.js";const I={apiKey:"AIzaSyCqm49bAzlJwx2SaTXJQZwrBMMM8BtP_1U",authDomain:"bolt-coffee-shop.firebaseapp.com",projectId:"bolt-coffee-shop",storageBucket:"bolt-coffee-shop.firebasestorage.app",messagingSenderId:"921119001263",appId:"1:921119001263:web:59aa28f9f2ce17ebb6225a"},y=D(I),c=T(y);M(y);try{q(c).catch(s=>{s.code==="failed-precondition"?console.warn("Multiple tabs open, persistence enabled in first tab only"):s.code==="unimplemented"&&console.warn("Browser doesn't support persistence")})}catch(s){console.warn("Error enabling persistence:",s)}const P=async(s,r)=>{const l=f(s,"yyyy-MM-dd"),t=A(m(c,"timeSlots"),g("date","==",l),g("time","==",r));return(await O(t)).size<1},z=async(s,r,l)=>{const t=f(s,"yyyy-MM-dd");await h(m(c,"timeSlots"),{date:t,time:r,orderId:l,createdAt:E.now()})},Q=()=>{const{items:s,getTotal:r,clearCart:l,collectionTime:t}=v(),{isDemoMode:n}=k(),o=C(),[p,u]=d.useState(!1),[b,j]=d.useState("");d.useEffect(()=>{(s.length===0||!t)&&o("/cart")},[s,t,o]);const w=async()=>{if(t){u(!0);try{if(!await P(t.date,t.time)){alert("Sorry, this time slot is no longer available. Please select another time."),o("/collection-time");return}const x={items:s.map(i=>({product:{name:i.product.name,price:Number(i.product.price)},quantity:Number(i.quantity),selectedOption:i.selectedOption||null})),total:Number(r()),pickupDate:t.date.toISOString(),pickupTime:t.time,createdAt:new Date().toISOString(),userId:"guest",userEmail:b||"guest",paymentStatus:n?"completed":"pending",status:"new"},S=await h(m(c,"orders"),x);await z(t.date,t.time,S.id),o("/confirmation",{state:{orderDetails:x},replace:!0}),setTimeout(()=>l(),100)}catch(a){console.error("Error placing order:",a),alert("There was an error placing your order. Please try again.")}finally{u(!1)}}};if(!t)return null;const N=r();return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Checkout"}),n&&e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-4 rounded-lg mb-6",children:[e.jsx("p",{className:"font-medium",children:"Demo Mode Active"}),e.jsx("p",{className:"text-sm",children:"Orders will be processed without real payments."})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Collection Time"}),e.jsxs("p",{className:"text-lg",children:[t.date.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," at ",t.time]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Contact Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (optional)"}),e.jsx("input",{type:"email",id:"email",value:b,onChange:a=>j(a.target.value),placeholder:"Enter your email for order updates",className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),s.map(a=>e.jsxs("div",{className:"flex justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.product.name}),e.jsxs("p",{className:"text-sm",children:["Quantity: ",a.quantity]})]}),e.jsxs("p",{className:"font-medium",children:["£",(a.product.price*a.quantity).toFixed(2)]})]},`${a.product.id}-${a.selectedOption||"no-option"}`)),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["£",N.toFixed(2)]})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>o("/menu"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Continue Shopping"}),e.jsx("button",{onClick:()=>o("/collection-time"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Change Collection Time"}),e.jsx("button",{onClick:w,disabled:p,className:"flex-1 bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-400",children:p?"Processing...":n?"Place Demo Order":"Place Order"})]})]})};export{Q as default};
//# sourceMappingURL=Checkout-CHsc5wPG.js.map
